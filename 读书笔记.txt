1974 TCP 传输控制协议

1984 蒂姆伯纳斯李 首个网页浏览器  www

OSI RM 开放系统互联参考模型

应用层  http
表示层  数据表示  数据安全 数据压缩
会话层  建立 管理 终止 会话
传输层  数据成数据段 segment 用一个寻址机制来标识一个特定的应用程序---端口号  网关
网络层  分割 重新组合数据包packet 基于网络层地址 IP地址 路径选择             路由器
数据链路层  将比特信息封装成数据帧frame   网桥 交换机 网卡
物理层  传输bit流   建立 维护  取消物理连接   光纤 同轴电缆 中继器  集线器

TCPIP  应用层  传输层  网络层  网络接口层（物理层  数据链路层）

IP协议 是不可靠 无连接协议

TCP 传输控制协议 是面向连接 可靠协议

UDP 用户数据报协议   是不可靠 无连接协议

TCP报文:
0-15     源端口号
16-31    目的端口号

32-63    序号字段  SEQ序号 数据流中每一个字节都有编上一个序号 序号字段的值
是本报文段所发送的数据的第一个字节的序号

64-95    确认字段  ACK序号 期待收到对方的下一个报文段的第一个字节序号
只有ACK标志位为1时 确认序号字段才有 ACK = SEQ + 1

标志位 6个
URG  紧急位
ACK  只有当ACK = 1 确认号字段才有效
PSH  推送位 push 当PSH为1的报文段 就尽快交付给接收应用进程 不再等到整个缓存都填满了后再向上交付
RST  复位  reset 当rest = 1 表明TCP连接中出现严重差错 必须释放连接 然后再重新建立连接
SYN  同步比特  当 SYN = 1 表示这是一个连接请求或连接接收报文
FIN  终止比特  用来释放一个连接  当FIN = 1时 表明此报文段的发送端的数据已发送完毕 并要求释放运输连接

注意: 不要将确认序号ACK与标志位中的ACK搞混了 确认方ACK = 发起方SEQ + 1 两端配对

数据偏移 4bit 

窗口字段 16bit 用来控制对方发送数量 单位字节 byte TCP连接的一端根据设置的缓存空间大小确定自己的接收窗口大小 然后通知对方以确定对方的发送窗口的上限

校验和  16bit 校验和字段校验的范围包括首部和数据两部分 在计算校验和时 要在TCP报文段的前面上12字节的伪首部

紧急指针字段 16bit 紧急指针指出在本报文段中的紧急数据的最后一个字节的序号

选项字段  长度可变  TCP只规定了一种选项 即最大报文段的长度MSS Maximum segment size MSS告诉对方TCP 我的缓存
所能接受的报文段的数据字段的最大长度是MSS个字节

TCP的连接和建立都是采用客户服务器方式

主动发起连接建立的应用进程叫客户端 Client

被动等待连接建立的应用进程叫做服务器 server

TCP的三次握手
Three-way shakehand

客户端                             服务器
1   客户端发送  SYN  SEQ=x  向服务器建立连接的请求
2   服务器发送  SYN ACK 这两个标志位  SEQ=y ACK=x+1 向客户端发一个报文 
                                                  这个报文确认服务器同意客户端
                                                  向服务器建立请求 
                                                  同时服务器向客户端发送
                                                  建立连接请求

3   客户端发送  ACK SEQ=x ACK=y+1  向服务器发送一个报文 这个报文客户端确认
                                                      服务器建立连接的请求

TCP的四次挥手
Four-way wavehand
客户端向服务器发送终止连接请求报文
服务器向客户端发送同意终止连接的确认报文
服务器客向户端发送终止连接请求报文
客户端向服务器发送同意终止连接的确认报文 

SEQ 是 发送报文的序号
ACK 是 已经收到报文的序号

客户端                             服务器
1  --->     ACK=1 FIN=1 标志位   SEQ=x  ACK=y
2  <---     ACK=1       标志位   SEQ=y  ACK=x+1
3  <---     ACK=1 FIN=1 标志位   SEQ=y+1
4  --->     ACK=1       标志位   SEQ=x+1  ACK=y+2

为何要两次发送终止请求？
由于TCP连接是全双工 每个方向都必须要单独进行关闭

块 segment 传输层   TCP
包 packet  网络层   IP
帧 frame   数据链路层


1973 从施乐辞职的罗伯特.麦特卡夫创立3COM 创立以太网标准

以太网 总线型

CSMA/CD 载波侦听多路复用--冲突检测

共享式以太网  

细缆 10BASE2 2指200m
粗缆 10BASE5 5指500m

1990 交换式以太网 诞生
交换式以太网核心设备是以太网交换机

VLAN 广播域


路由器
信息中转站 能够将不同格式的数据连接在一起

SNMP 简单网络管理协议
CMIP 公共管理信息协议

1. 以太网编码规则
以太网属于数据链路层
包含48位MAC地址  24位设备商标识符 24产品标识符
ipconfig -all

ARP IP地址与MAC地址 绑定 删除

-s IP地址与MAC地址绑定

-d IP地址与MAC地址解绑

-a 查看IP地址与MAC地址的对应

2. IPV4  32位二进制 就是4个字节
公有地址分为A B C D E 五类
私有地址分为A B C三类

公有地址:
A 0 - 127
B 128 - 191   
C 192 - 223
D 224 - 239  用于组广播

0.0.0.0 缺省网络
127.0.0.0 --- 127.0.0.8 回环地址 本地软件回送测试地址 保留不分配

私有地址:
A类  10.0.0.0/8 - 10.255.255.255
B类  172.16.0.0/12 - 172.31.255.255
c类  192.168.0.0/16 - 192.168.255.255

网络号 + 主机号/ 子网掩码

主机数 2**n - 2   这个2是因为 1个网络号：0000  1个网络号后11111是广播地址

无类域间路由  主机位向网络位借用
classless inter-domain routing CIDR
超网
基本思想是:
取消IP地址的分类结构
将多个地址聚合在一起生产一个更大网络
已包含更多的主机

可变长子网掩码  网络位向主机位借用

3. IP封包原则
一个IP包的长度 从32字节到65535字节

4.IP包转发规则
路由协议 分为静态路由协议 动态路由协议
动态路由协议 内部网关协议  外部网关协议
内部网关协议: RIP2 OSPF TGRP EIGRP
外部网关协议: BGP

若IP节点未明确规定下一跳路径 则按照缺省路径 转发

5. 报文控制协议
ICMP Internet Control message protocol 互联网控制协议
是IP组成部分

6. TCP/UDP
传输层协议

7.域名解析规则
主机名与IP地址映射关系

8. 端口
TCPIP协议中 端口号用于区分不同的网络服务
按照协议区分有两类 TCP端口 UDP端口
固定端口 0- 1023
80 www  21 ftp
1024 - 65535 动态端口

端口特指TCPIP协议中的一种逻辑标识
为了实现IP地址与网络服务的关系是一对多关系
ip+prot 区别不同服务

9. 广播与组播
广播与组播只适用于UDP
广播是指将信息发送给所有能到达的地址
组播是指将信息发送给定义在一组内的地址

IP世界有: 单播 组播 广播

隧道:采用的都是IP封装技术---就是将纯文本的报文加密 封装在外层的IP包头里
然后进行路由和交换 到达另一端 外层的IP包头被打开 报文被解密 然后送到目的地
这是一种信封套信封的方式  也被称为隧道

传输层安全
在两端进程之间的通信进制进行加密和安全认证
从而达到保证IP网络的安全传送的目的

安全套接层协议SSL


10. 网络地址转换法
NAT network address translation 
将IP地址从一个编址域映射到另一个编址域的方法
最典型的应用把私有IP地址映射为公有IP地址

静态NAT 动态NAT 网络地址端口转换NAPT

静态NAT 
一个私有地址与一个公有地址绑定

动态NAT
一些私有地址与一个公有地址池获得一个地址绑定

NAPT
一些私有地址与一个公有地址+端口进行绑定

11 LAN MAN WAN VLAN WLAN
局域网 城域网 广域网 虚拟局域网 无线局域网

BPS Byte per second 

bps bits per second

1Byte = 8bits

VLAN 分为基于端口的静态VLAN 和 基于IP地址动态VLAN

物理层        中继设备      HUB
数据链路层    中继设备      交换机 网卡
网络层        中继设备     路由器
传输层        中继设备     网关  协议转换器


交换机分为三层交换机  和 二层交换机

普通交换机是二层交换机 基于数据链路层
可以识别数据包中的MAC地址信息 根据MAC地址进行转发
并将这些MAC地址与对应的端口记录在自己内部的一个地址表中

工作流程:
1. 当交换机从某个端口收到一个数据包 它先读取包头中的源MAC地址 这样就知道源MAC地址
的机器是连在哪个端口上

2. 再去读取包头中的目的MAC地址 并在自身地址表中查找相应的端口

3. 如果表中有与这目的MAC地址对应的端口 就把数据包发送到这个端口

4. 如果表中没有 然后广播到所有端口 当目的机器对应源机器回应时 交换机又可以学习一目的MAC地址
与那个端口对应 下次就不需要广播

路由器
相同网络号的IP地址之间进行 要与其他IP子网的主机进行通信 则必须经过同一网络上的某个路由器
或网关出去 不同网络号的IP地址不能直接通信 即使他们接在一起也不能通信

路由器只根据IP地址来转发数据 路由器有多个端口 用于连接多个IP子网
每个端口对应不同的IP网段 而不是单一的IP地址
每个端口的IP地址的网络号 要求与所连接的IP子网的网络号相同
不同的端口为不同的网络号 对应的不同IP子网
这样才能使各子网的主机通过自己子网的IP地址把要求出去的IP分组
送到路由器上。

路由器的端口分为两类 局域网接口 FastEthernet 和 广域网接口 Serial

局域网接口用来连接局域网 拥有二层MAC地址 可被分配三层IP地址 通常RJ45接口

广域网接口用来连接广域网 使用三层IP地址

静态路由

动态路由 内部网关协议 IGP 和 外部网关协议  EGP

默认路由

所有路由中静态路由优先级最高

路由器工作原理:
当路由器的某个接口收到一个包时 路由器会读取包中相应的目标的IP地址的网络号
然后在路由表中进行查找
如果在路由表中找到了目标地址的路由条目
则把数据包转发到相应接口
如果没找到 就会走默认路由
如果没有配置默认路由 则丢弃该数据包 并返回不可达的信息

路由协议:
静态路由  人工设置
静态路由缺点: 网络可变 无法满足

动态路由

路由器负责IP包选路和和转发功能

路由协议: 内部路由协议 IGP   
         外部路由协议 EGP

内部路由协议:   距离矢量算法     RIP2  EIGRP
               链路状态算法     IS-IS OSPF

外部路由协议:   BGP V4

所谓内部和外部 都是相对于自治域AS来说

内部路由协议是自治域的内政政策

外部路由协议是自治域间的外交政策

自治域是指在IP世界中 拥有同一选路策略 在同一管理机构下运行的一组路由器
自治域简称AS
例如 电信 移动

RIP2路由器之间交换的是路由表
一条链路如果发生变化 就意味着需要重新通告N条涉及到路由条目
因此不适应大型网络

链路状态路由协议交换不是路由表 而是链路状态
完成交换后每台路由器都有完全相同的拓扑

TTL time to live 生存时间
给每个数据包赋予一个TTL值
每经过一个路由器就将这个值减1
当TTL值为0的时候 就将数据包丢弃

史上最简单的动态路由协议叫做RIP 称为 距离向量协议

RIP2中路由器每隔30秒将所谓的距离向量信息发送到相邻路由器
路由表只存储到目的站点的最佳路径的下一跳地址
RIP2选择最佳路径 将以最小路由器跳数为依据
RIP2允许最大跳数为15跳Hop 超过15跳被认为是不可达

IS-IS协议  中间系统到中间系统


OSPF open shortest path first 开发式最短路径优先协议








VPN
v virtual 虚拟
p private 私有
N network 网络

是远程访问技术 利用公有网络架构私有网络

解决方法:在内网中架设一台VPN服务器 VPN服务器有两个网卡 一块连接内网 一块连接公网
通过互联网找到VPN服务器 然后利用VPN服务器作为跳板进入企业内网
并且传输的数据进行加密

VPN实质上就是利用加密技术在公网上封装出一个数据通信隧道

流量负载均衡
1. 链路负载均衡
2. 服务器负载均衡

DOS/DDOS攻击

DDOS攻击 分布式拒绝服务 distributed denial of service

最基本DOS攻击是利用合理的服务请求占用过多的服务资源


TCPIP常用命令:

ipconfig/all

ping host
-a 将地址解析为计算机名

ping 127.0.0.1 为了检查本地的IP地址是否设置有误

ping 外部IP地址 检查本网或本机与外部的连接是否正常

traceroute (window tracert)
可以知道自己主机到所连接的主机是走什么路径
traceroute通过发送小的数据包到目的设备直到其返回
来测量其需要多长时间

netstat 了解网络的整体使用情况

netstat -t  显示本机路由表的内容

netstat -s  显示每个协议的使用状态

netstat -n  以数字表格形式显示地址和端口

netstat -a  显示所有主机的端口号

ARP
基本功能就是通过目标设备的IP地址查询目标设备的MAC地址
arp -a  显示所有的ARP表项

arp -s  在ARP缓存中添加一条记录

arp -d  在ARP缓存中删除一条记录

route 在本地IP路由表中显示 修改条目 手动配置静态路由表

route print 显示完整IP路由表的内容
route add   添加
route delete 删除

CDN 内容分发网络

SDN 软件定义网络


清空DNS缓存命令为: ipconfig/flushdns 
查看DNS缓存内容为： ipconfig/display

